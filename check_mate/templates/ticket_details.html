{% extends "index.html" %}

{% load task_card %}
{% load section_header %}
{% block content %}
{% for message in messages %}
<div class="{{message.tags}} alert" role="alert">{{message}}</div>
{% endfor%}

{% section_header "Ticket" ticket_detail %}


<div class="row">
  <div class="col">
  <div class="text-center">
    <h5>Related Tasks:</h5>
      {% if ticket_detail.task_set.all %}
    <form action="{% url 'check_mate:task_add' %}" method="POST">
      {% csrf_token %}
      <input type="submit"><i class="fas fa-plus"></i></input>
      <input type="hidden" name="ticket" value="{{ticket_detail.id}}"/>
      <input type="hidden" name="first_request"/>
    </form>
      {% endif %}
  </div>
  <div class="list-group">
    {% if not ticket_detail.task_set.all %}
      <div class="jumbotron">
        <h6 class="display-4">No Tasks for {{ticket_detail.ticket_name}}</h6>
        <p class="lead">Add new tasks for this project</p>
        <form action="{% url 'check_mate:task_add' %}" method="POST">
            {% csrf_token %}
            <input type="submit"><i class="fas fa-plus"></i></input>
            <input type="hidden" name="ticket" value="{{ticket_detail.id}}"/>
            <input type="hidden" name="first_request"/>
          </form>
      </div>
      {% endif %}
      {% for task in ticket_detail.task_set.all %}
          <a href="" class="list-group-item list-group-item-action flex-column align-items-start">
              <div class="d-flex w-100 justify-content-between">
                  <h5 class="mb-1">{{task.task_name}}</h5>
            <p>Task Status: {% status_badge task.task_status %}</p>
                  <p>{{task.task_description}}</p>
                  {% if task.task_assigned_user is not None %}
                    <p>Assigned Team Member: {{task.task_assigned_user.first_name}} {{task.task_assigned_user.last_name}}</p>
                  {% else %}
                    <p>Task currently unassigned</p>
                  {% endif %}
                  <a href="{% url 'check_mate:task_edit' task.id %}">Edit Task</a>
                  {% if task.delete_status == True %}
                    <a href="{% url 'check_mate:task_delete' task.id %}">Delete Task</a>
                  {% endif %}
              </div>
          </a>
      {% endfor %}
  </div>
  <div>
    {% if all_history %}
      {% for history in all_history %}
        <p>{{history.description}}</p>
        <p>{{history.activity_date| date:"l, F d, Y"}}</p>
        <p>{{history.activity_date | timesince }}</p>
      {% endfor %}
    {% else %}
      <p>No History available for this ticket</p>
    {% endif %}
  </div>
</div>
{% endblock content %}